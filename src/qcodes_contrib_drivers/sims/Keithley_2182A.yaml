spec: "1.1"
devices:
  Keithley2182A:
    error:
      status_register:
        - q: "*STB?"
          command_error: 32
          query_error: 4
    eom:
      GPIB INSTR:
        q: "\n"
        r: "\n"
      ASRL INSTR:
        q: "\n" 
        r: "\n"
      USB INSTR:
        q: "\n"
        r: "\n"
      TCPIP INSTR:
        q: "\n"
        r: "\n"
    
    properties:
      # Measurement function mode
      function:
        default: '"VOLT:DC"'
        getter:
          q: "SENS:FUNC?"
          r: "{}"
        setter:
          q: "SENS:FUNC {}"
        specs:
          type: str
      
      # Voltage range
      range:
        default: 1.0
        getter:
          q: "SENS:VOLT:RANG?"
          r: "{:e}"
        setter:
          q: "SENS:VOLT:RANG {}"
        specs:
          type: float
      
      # Auto range setting - use ON/OFF strings
      auto_range:
        default: "ON"
        getter:
          q: "SENS:VOLT:RANG:AUTO?"
          r: "{}"
        setter:
          q: "SENS:VOLT:RANG:AUTO {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # NPLC (Number of Power Line Cycles)
      nplc:
        default: 1.0
        getter:
          q: "SENS:VOLT:NPLC?"
          r: "{:e}"
        setter:
          q: "SENS:VOLT:NPLC {}"
        specs:
          type: float
      
      # Aperture time
      aperture:
        default: 0.016667
        getter:
          q: "SENS:VOLT:APER?"
          r: "{:e}"
        setter:
          q: "SENS:VOLT:APER {}"
        specs:
          type: float
      
      # Trigger source
      trigger_source:
        default: "IMM"
        getter:
          q: "TRIG:SOUR?"
          r: "{}"
        setter:
          q: "TRIG:SOUR {}"
        specs:
          type: str
      
      # Trigger delay
      trigger_delay:
        default: 0.0
        getter:
          q: "TRIG:DEL?"
          r: "{:e}"
        setter:
          q: "TRIG:DEL {}"
        specs:
          type: float
    
      
      # Display enabled - use ON/OFF strings
      display_enabled:
        default: "ON"
        getter:
          q: "DISP:ENAB?"
          r: "{}"
        setter:
          q: "DISP:ENAB {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      
      # Analog filter - use ON/OFF strings
      analog_filter:
        default: "OFF"
        getter:
          q: "SENS:VOLT:DC:LPAS?"
          r: "{}"
        setter:
          q: "SENS:VOLT:DC:LPAS {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Digital filter - use ON/OFF strings
      digital_filter:
        default: "OFF"
        getter:
          q: "SENS:VOLT:DC:DFIL?"
          r: "{}"
        setter:
          q: "SENS:VOLT:DC:DFIL {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Auto-zero - use ON/OFF strings
      auto_zero:
        default: "ON"
        getter:
          q: "SYST:AZER?"
          r: "{}"
        setter:
          q: "SYST:AZER {}"
        specs:
          type: str
          valid: ["ON", "OFF"]
      
      # Line frequency detection
      line_frequency:
        default: 60.0
        getter:
          q: "SYST:LFR?"
          r: "{:g}"
        specs:
          type: float
    
    dialogues:
      # IDN query
      - q: "*IDN?"
        r: "KEITHLEY INSTRUMENTS INC.,MODEL 2182A,1234567,C01/B01"

      # Reset and clear commands
      - q: "*RST"
        r: ""
      - q: "*CLS"
        r: ""
      - q: "*TST?"
        r: "0"

      # Core measurement commands - always return consistent values
      - q: "MEAS:VOLT:DC?"
        r: "1.234567E-06"
      - q: "FETC?"
        r: "1.234567E-06"
      - q: "READ?"
        r: "1.234567E-06"

      # Trigger commands
      - q: "INIT"
      - q: "ABOR"
      - q: "*TRG"

      # Error query
      - q: "SYST:ERR?"
        r: "0,\"No error\""

resources:
  GPIB0::1::INSTR:
    device: Keithley2182A